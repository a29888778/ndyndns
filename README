ndyndns, Copyright (c) 2005-2007
Nicholas J. Kain < njkain <at> gmail <dot> com >
Licensed under GPL2.

REQUIREMENTS
============
Linux-based system (2.6.x tested)
gcc (3.3.5-4.1.2 tested), curl+libcurl (7.14.0+ tested)

Note that it is quite possible to add support for non-Linux systems.  However,
I don't have any such systems here, so patches would be welcome.  Please
refer to linux.c and linux.h and duplicate the platform-specific functions
defined there for your operating system.


INSTALLING
==========

It is much easier to install ndyndns from a distro-provided package, since
they will almost certainly set up a correct chroot enviromnent for you.  The
following instructions are for performing a generic install that is relatively
distro-agnostic.  Using vendor packages is highly reccomended if they are
available, since it will spare you the pain of setting up a working chroot.

If you have problems, I suggest running ndyndns in -n mode so that you can
see errors printed at the command prompt.  It will make debugging your
chroot and configuration much easier.

Building:
--------

make
make install
groupadd -g dyndns
useradd -g dyndns dyndns
mkdir /var/lib/ndyndns
chown dyndns.dyndns /var/lib/ndyndns
vim /etc/ndyndns.conf

-----------------
example config
-----------------

username=test
password=test
hostname=test.dyndns.org,test.ath.cx,test.dnsalias.net,test.dnsalias.org
wildcard

-----------------


Constructing the chroot:
-----------------------

You'll need to copy over your libresolv/nss libraries into the chroot if you
are using a glibc system.  On my amd64 system, the working chroot looks like:

I would suggest hardlinking the files to save space, if possible.

.:
dev  lib
etc  lib64

./dev:
null  random  urandom

./etc:
hosts  nsswitch.conf  resolv.conf

./lib:
libnss_compat-2.3.5.so  libnss_files.so.2        libnss_nisplus.so.2
libnss_compat.so.2      libnss_hesiod-2.3.5.so   libnss_nis.so.2
libnss_dns-2.3.5.so     libnss_hesiod.so.2       libresolv-2.3.5.so
libnss_dns.so.2         libnss_nis-2.3.5.so      libresolv.so.2
libnss_files-2.3.5.so   libnss_nisplus-2.3.5.so

./lib64:
libnss_compat-2.3.5.so  libnss_files.so.2        libnss_nisplus.so.2
libnss_compat.so.2      libnss_hesiod-2.3.5.so   libnss_nis.so.2
libnss_dns-2.3.5.so     libnss_hesiod.so.2       libresolv-2.3.5.so
libnss_dns.so.2         libnss_nis-2.3.5.so      libresolv.so.2
libnss_files-2.3.5.so   libnss_nisplus-2.3.5.so

If you are using default paths (/var/lib/ndyndns) and user/group
(dyndns/dyndns), then the following commands will set up correct permissions.

find /var/lib/ndyndns -type d chmod 755 {} \;
find /var/lib/ndyndns -type d chown root.root {} \;
find /var/lib/ndyndns chmod 644 {} \;
find /var/lib/ndyndns chown root.root {} \;
chown dyndns.dyndns /var/lib/dyndns
chmod 700 /var/lib/dyndns

Then all that remains is to invoke ndyndns:

ndyndns -n -c /var/lib/ndyndns -f /etc/ndyndns.conf -i eth0 -u dyndns -g dyndns

Problems:
--------

If you are having problems with DNS resolution, then it is quite likely that
your chroot is not properly set up.  "Temporary error connecting to host:
[Couldn't resolve host '...']." almost certainly indicates that your chroot is
missing necessary libraries if your other programs are properly resolving DNS.

Make certain that you have all the libnss_* and libresolv* libraries accessible
and with proper permissions.  They should be either hardlinks to your real
libraries or copies.  Symlinks will not be accessible from the chroot.

If you're running a 64-bit system, you will likely need the libraries from
lib64 rather than lib.


TROUBLESHOOTING
===============

Note that for certain classes of error, ndyndns will refuse to update a
given hostname.  This condition will only affect one hostname if multiple
hosts are present.  The error can be found by looking at
<CHROOTDIR>/<HOST>-dnserr.  Once the problem has been corrected, it is
only necessary to remove the corresponding <CHROOTDIR>/<HOST>-dnserr file
to resume updates.

ndyndns atomically keeps state information in the <CHROOTDIR>.  If it
becomes outdated, corrupt, or whatever, just delete the files there.  However,
it's not a good idea to unnecessarily remove these files, since they are
what allow ndyndns to avoid frivolous updates between restarts and reboots.


CONTACT
=======

ndyndns is completely compliant with dyndns.org's protocol specs and client
recommendations, at least as far as I can tell.  If you find any problems,
don't hesitate to contact me.


